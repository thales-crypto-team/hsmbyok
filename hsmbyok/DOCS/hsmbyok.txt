
  Copyright (c) 2019 SafeNet. All rights reserved.


Command-line

  hsmbyok --generate-and-wrap-target-key

  Generates a .byok file using a key generated in an HSM
  and options in an INI file.


INI file

  INI file 'HsmConfig.ini' is in the current working directory.
  It consists of one [sectionName] followed by multiple valueName=value pairs.

  Value is typically treated as a string.

    eg valueName = this is good

  Double-quotes can be used to disambiguate string start/end.

    eg valueName = "this is better"

  Comma should be used to delimit multiple values on the same line.

    eg targetKeySpec = CKK_RSA, 2048, none

  Some things are not case-sensitive

    eg targetKeySpec = CKK_RSA, 2048, none

    is same as

    eg targetkeyspec = ckk_rsa, 2048, NONE

  Literal strings are case-sensitive; ie characters within quotes are not converted to lowercase/uppercase.

    eg libraryName = "./libcklog2.so"
    eg tokenLabel = "par1ssm011"
    eg SchemaVersion = "1.0.0.0"
    eg kid = "https://myvault.vault.azure.net/keys/mykek/FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF"
    eg targetKeyName =  "my-target-key-rsa"

  The comment character ";" and its following text is ignored.


libraryName

  Specify relative/absolute path of cryptoki library.

    eg libraryName = "./libcklog2.so"
    eg libraryName = ".\cryptoki.dll"


tokenLabel

  Specify the label of cryptoki token to find.

    eg tokenLabel = "par1ssm011"


wrappingCiphers

  Specify the preferred/available wrapping cipher.

    eg wrappingCiphers = CKG_MGF1_SHA1, CKM_RSA_AES_KEY_WRAP
    eg wrappingCiphers = CKG_MGF1_SHA1, CKM_AES_KWP


SchemaVersion

  Specify the schema version that can validate ".byok" files generated by this utility.

    eg SchemaVersion = "1.0.0.0"


kid

  specify the URI location of the vault (key encrypting key).

    eg kid = "https://myvault.vault.azure.net/keys/mykek/FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF"


targetKeyName

  Specify the key label used during key finding and key generation.

    eg targetKeyName =  "my-target-key-rsa"  


targetKeySpec

  Specify the entire keySpec used during key generation.

    eg targetKeySpec = CKK_RSA, 2048, none
    eg targetKeySpec = CKK_EC, 384, "P-384"
    eg targetKeySpec = CKK_AES, 256, none

  Supported RSA keySizeBits:

    1024 thru 8192

  Supported EC curveName / curveAliasName:

    "X9_62_prime256v1"  "P-256"
    "secp384r1"         "P-384"
    "secp521r1"         "P-521"
    "secp256k1"         "P-256K"

  Supported AES keySizeBits:

    128 thru 256


targetKeyFlags

  Specify flags used during key generation.

    eg targetKeyFlags = CKF_ENCRYPT,CKF_DECRYPT,CKF_SIGN,CKF_VERIFY,CKF_DERIVE,CKF_TOKEN,CKF_MODIFIABLE,CKF_EXTRACTABLE,CKF_CREATE_IF_NOT_FOUND  

  Notes:

    CKF_ENCRYPT meaning CKA_ENCRYPT=1. Otherwise CKA_ENCRYPT=0.

    CKF_DECRYPT meaning CKA_DECRYPT=1. Otherwise CKA_DECRYPT=0.

    CKF_SIGN meaning CKA_SIGN=1. Otherwise CKA_SIGN=0.

    CKF_VERIFY meaning CKA_VERIFY=1. Otherwise CKA_VERIFY=0.

    CKF_DERIVE meaning CKA_DERIVE=1. Otherwise CKA_DERIVE=0.

    CKF_TOKEN meaning CKA_TOKEN=1. Otherwise CKA_TOKEN=0.

    CKF_MODIFIABLE meaning CKA_MODIFIABLE=1. Otherwise CKA_MODIFIABLE=0.

    CKF_EXTRACTABLE meaning CKA_EXTRACTABLE=1. Otherwise CKA_EXTRACTABLE=0.

    CKF_CREATE_IF_NOT_FOUND meaning generate the key if key not found.  Otherwise error (CKR_OBJECT_NOT_FOUND).


Example 1.

  ;
  ; sample File 'HsmConfig.ini' on Windows
  ;

  ;
  ; options for byok command
  ;
  [ byok ]

  ; cryptoki library
  libraryName = ".\cryptoki.dll"

  ; label of partition
  tokenLabel = "par1hsm1"

  ; available ciphers for wrapping
  wrappingCiphers = CKG_MGF1_SHA1, CKM_AES_KWP

  ; label of key to find/generate
  targetKeyName = "my-target-key-rsa1"

  ; details of key to generate
  targetKeySpec = CKK_RSA, 2048, none
  targetKeyFlags = CKF_ENCRYPT, CKF_DECRYPT, CKF_SIGN, CKF_VERIFY, CKF_DERIVE, CKF_TOKEN, CKF_MODIFIABLE, CKF_EXTRACTABLE

  ; Azure kid
  kid = "https://myvault.vault.azure.net/keys/mykek/FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF"

  ; Azure schema
  SchemaVersion = "1.0.0.0"


  Copyright (c) 2019 SafeNet. All rights reserved.
